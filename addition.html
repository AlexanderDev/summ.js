<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Addition</title>
    <style type="text/css">
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, Helvetica, Sans-Serif;
            color: black;
        }
        
        .header {
            min-height: 3em;
            margin-bottom: 2em;
        }
        
        .header #wrapper {
            text-align: center;
        }
        /* Header text */
        
        .header div {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .header #wrapper div {
            display: inline-block;
            vertical-align: middle;
        }
        /* Text */
        
        .header #wrapper div:last-child {}
        /* Logo */
        
        .header #wrapper div:first-child {
            margin: 8px 30px 3px 0px;
        }
        
        .header hr {
            border: none;
            background-color: #32382C;
            height: 2px;
        }
        
        .maket {
            min-height: 100%;
            position: relative;
            width: 90%;
            max-width: 1100px;
            margin: auto;
        }
        
        #content,
        .header #wrapper {}
        
        #content {
            /*padding-top: 2%;*/
            text-align: center;
            padding-bottom: 6em;
            overflow: auto;
        }
        
        div.task span {
            font-size: 2em;
            font-weight: bold;
        }
        
        canvas {
            position:absolute;
            left:0px;
            top:0px;
        }

        div.canvas_cont {
            margin: 0 auto;
            position:relative; 
            width:900px; 
            height:500px;
            top:2em;
        }

        .overcurve {
            width:10px; 
            position:absolute; 
            left:0px;
            top:0px;
        }

    </style>
</head>

<body>
    <script type="text/javascript">
        // Геометрия
        ///////////////////////////////////////////////////////////////////////////////
        function Point(x, y) {
            return {
                x: x,
                y: y
            }
        }

        function Vector(x, y) {
            return {
                x: x,
                y: y
            }
        }

        function subtraction_vec(a, b) {
            return Vector(a.x - b.x, a.y - b.y)
        }

        function normal(vec) {
            return normalize(Vector(vec.y, -vec.x))
        }

        function len_vec(vec) {
            return Math.sqrt(vec.x * vec.x + vec.y * vec.y);
        }

        function normalize(vec) {
            l = len_vec(vec)
            return Vector(vec.x / l, vec.y / l)
        }

        function sum_vec(a, b) {
            return Vector(a.x + b.x, a.y + b.y)
        }

        function rotate_vec(vec, deg) {
            radians = to_rad(deg)
            ca = Math.cos(radians);
            sa = Math.sin(radians);
            return Vector(ca * vec.x - sa * vec.y, sa * vec.x + ca * vec.y)
        }

        function vec_scalar(vec, scalar) {
            return Vector(vec.x * scalar, vec.y * scalar)
        }

        function to_rad(deg) {
            return deg * Math.PI / 180
        }

        // Графические элементы
        ///////////////////////////////////////////////////////////////////////////////
        function draw_vec(ctx, vec, start_point) {
            end_point = sum_vec(vec, start_point)
            ctx.beginPath();
            ctx.moveTo(start_point.x, start_point.y);
            ctx.lineTo(end_point.x, end_point.y);
            ctx.lineWidth = 1.5;
            // ctx.strokeStyle="red";
            ctx.stroke();
            draw_arrow(ctx, normalize(vec), end_point, 10)
        }

        function draw_arrow(ctx, direction, end_point, len) {
            left = vec_scalar(rotate_vec(direction, 160), len)
            right = vec_scalar(rotate_vec(direction, -160), len)
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(end_point.x, end_point.y);
            ctx.lineTo(end_point.x + left.x, end_point.y + left.y);
            ctx.moveTo(end_point.x, end_point.y);
            ctx.lineTo(end_point.x + right.x, end_point.y + right.y);
            ctx.stroke();
            ctx.restore();
        }

        function draw_point(ctx, point, radius) {
            ctx.beginPath();
            ctx.arc(point.x, point.y, radius, 0, 2 * Math.PI, true);
            ctx.stroke();
        }

        function draw_curve(ctx, start_point, end_point, radius) {
            direction = subtraction_vec(end_point, start_point)
            radius = typeof(radius) != 'undefined' ? radius : len_vec(direction) * 0.4;

            // Найти точку над отрезком
            function uppoints(ratio, height) {
                return sum_vec(sum_vec(
                    vec_scalar(normalize(direction), len_vec(direction) * ratio),
                    vec_scalar(normal(direction), height)
                ), start_point)
            }


            midpoint1 = uppoints(1 / 5.0, radius)
            midpoint2 = uppoints(4 / 5.0, radius)
            midpoint = uppoints(0.5, radius)

            draw_arrow(ctx, normalize(subtraction_vec(end_point, midpoint2)), end_point, 10)

            // draw_point(ctx, midpoint1, 2)
            // draw_point(ctx, midpoint2, 2)
            // draw_point(ctx, midpoint, 2)

            ctx.beginPath();
            ctx.moveTo(start_point.x, start_point.y);
            ctx.bezierCurveTo(midpoint1.x, midpoint1.y, midpoint2.x, midpoint2.y, end_point.x, end_point.y);
            ctx.stroke();

            return midpoint
        }

        // Элементы страницы
        ///////////////////////////////////////////////////////////////////////////////
        function Ruler(ctx_img, img_name, start_point, end_point, unit_px) {
            var loaded = false
            var width, height

            img = new Image();
            img.src = img_name
            img.onload = function() {
                loaded = true
                ctx_img.drawImage(img, 0, 0)
                width = img.width
                height = img.height
            }

            return {
                add_range:function(ctx, start, stop){
                    function unit2px(unit){
                        return Point(start_point.x+unit_px*unit, start_point.y)
                    }
                    draw_curve(ctx, unit2px(start), unit2px(stop))
                }
            }
        }

        function Input(cssclass){
            var input = document.createElement("input");
            input.type = "text";
            input.className = "overcurve"; 
            return {
                append:function(parent){
                    parent.appendChild(input);
                },
                remove:function(){
                    input.remove()
                }
            }
        }


        window.onload = function() {
            var canvas_top = document.getElementById('canvas_top');
            var canvas_bottom = document.getElementById('canvas_bottom');

            var ctx_bottom = canvas_bottom.getContext("2d");
            var ctx_top = canvas_top.getContext("2d");

            ctx_top.lineWidth = 1.7;

            //Вертикальное смещение обеспечивающие прострастао для рисование стрелок
            ctx_top.translate(0,300); 
            ctx_bottom.translate(0,300); 

            ruler = Ruler(ctx_bottom, 'sprite.png', Point(35, 5), Point(815, 5), 39)
            ruler.add_range(ctx_top, 0, 5)
            ruler.add_range(ctx_top, 0, 20)

            input = Input("overcurve")
            input.append(document.getElementsByClassName("canvas_cont")[0])
            // input.remove()

        }
    </script>
    <div class="maket">
        <div class="header">
            <div id="wrapper">
                <div>Сложите два числа</div>
            </div>
            <!-- Horisontal line -->
            <hr>
        </div>
        <div id="content">
            <div class="task"><span>7+14 = 11</span></div>
            <div class="canvas_cont">
                <!-- <input type="text" class="overcurve" name=""> -->
                <canvas id="canvas_top" style="z-index: 2;" width="900" height="500"></canvas>
                <canvas id="canvas_bottom" style="z-index: 1;" width="900" height="500"></canvas>
            </div>
        </div>
    </div>
</body>

</html>